# AGENTS.md - Walnut Admin Client

This document provides essential information for AI coding agents working on the Walnut Admin Client project.

## Project Overview

Walnut Admin Client is an open-source back-office management system template built with Vue 3 and TypeScript. It is the frontend part of the Walnut Admin full-stack solution. The backend uses NestJS with MongoDB (see [walnut-admin-server](https://github.com/walnut-admin/walnut-admin-server)).

- **Name**: walnut-admin-client
- **Version**: 1.17.0
- **License**: MIT
- **Demo**: https://www.walnut-admin.com
- **Documentation**: https://walnut-admin-doc.netlify.app

## Technology Stack

### Core Framework
- **Vue**: 3.5.21 (Composition API)
- **TypeScript**: 5.9.2
- **Vite**: 7.1.5

### UI & Styling
- **Naive UI**: 2.43.2 (Component library)
- **UnoCSS**: 66.5.1 (Atomic CSS framework)
- **Animate.css**: 4.1.1 (CSS animations)
- **SCSS**: For custom styling

### State Management & Routing
- **Pinia**: 3.0.3 (State management)
- **Vue Router**: 4.5.1
- **Vue I18n**: 11.1.12 (Internationalization)

### HTTP & Real-time
- **Axios**: 1.11.0 (HTTP client with custom adapters)
- **Socket.io-client**: 4.8.1 (WebSocket)

### Key Libraries
- **VueUse**: 13.9.0 (Vue utilities)
- **lodash-es**: 4.17.21 (Utilities)
- **sortablejs**: 1.15.6 (Drag and drop)
- **echarts**: 6.0.0 (Charts)
- **tinymce**: 8.0.2 (Rich text editor)
- **cropperjs**: 2.0.1 (Image cropping)
- **driver.js**: 1.3.6 (User onboarding)

## Project Structure

```
├── src/
│   ├── api/              # API layer - organized by module (auth, system, app, security)
│   │   └── base.ts       # BaseAPI class for CRUD operations
│   ├── App/              # Application bootstrap
│   │   ├── src/          # App.vue, providers, hooks, scripts
│   │   └── index.ts      # Main export
│   ├── assets/           # Static assets and SCSS styles
│   │   └── styles/       # SCSS files organized by purpose
│   ├── components/       # Vue components organized by category
│   │   ├── Advanced/     # High-level components (CRUD, ApiSelect)
│   │   ├── App/          # App-level components (Lock, Search, Settings)
│   │   ├── Business/     # Business components (Dict, AreaCascader)
│   │   ├── Extra/        # Extra utilities (Copy, QRCode, Password)
│   │   ├── Global/       # Global components (Cap, DevSettings)
│   │   ├── HOC/          # Higher-order components
│   │   ├── UI/           # UI wrapper components (Form, Table, Modal)
│   │   └── Vendor/       # Third-party wrappers (CodeMirror, ECharts, Tinymce)
│   ├── const/            # Constants
│   ├── core/             # Core initialization
│   ├── hooks/            # Custom composables
│   │   ├── app/          # App-related hooks
│   │   ├── component/    # Component utilities
│   │   ├── core/         # Core utilities
│   │   ├── vueuse/       # VueUse extensions
│   │   └── web/          # Web API hooks
│   ├── layout/           # Layout components
│   │   ├── default/      # Default layout (header, aside, tab, footer)
│   │   ├── iframe/       # Iframe wrapper layout
│   │   └── mainout/      # Full-page layout (no sidebar)
│   ├── locales/          # i18n configuration
│   ├── plugins/          # Plugin installations
│   ├── router/           # Vue Router setup
│   │   ├── guard/        # Route guards
│   │   └── routes/       # Route definitions
│   ├── socket/           # Socket.io configuration
│   ├── store/            # Pinia stores
│   │   └── modules/      # Organized by feature (app, user, component, setting)
│   ├── utils/            # Utilities
│   │   ├── axios/        # Axios instance with interceptors
│   │   ├── crypto/       # Cryptographic functions (RSA, AES-GCM, HKDF)
│   │   ├── persistent/   # Storage abstraction (localStorage, IndexedDB)
│   │   └── ...           # Other utilities
│   └── views/            # Page components
│       ├── auth/         # Authentication pages
│       ├── demo/         # Demo and examples
│       ├── system/       # System management pages
│       ├── app/          # Application pages
│       ├── me/           # User profile pages
│       └── index/        # Dashboard and home
├── build/                # Build configuration
│   ├── vite/             # Vite plugins and config
│   │   ├── plugin/       # Individual plugin configurations
│   │   ├── config/       # Environment validation schemas
│   │   └── proxy.ts      # Development proxy
│   ├── generate/         # Code generation scripts
│   └── utils/            # Build utilities
├── env/                  # Environment files (templates)
├── env-local/            # Local environment files (gitignored)
├── types/                # TypeScript type declarations
│   ├── auto-import.d.ts  # Generated by unplugin-auto-import
│   ├── components.d.ts   # Generated by unplugin-vue-components
│   └── *.d.ts            # Various type declarations
├── public/               # Public static assets
└── scripts/              # Release scripts
```

## Build and Development Commands

### Development
```bash
# Start development server
pnpm dev

# Clean cache
pnpm clean:cache
```

### Build
```bash
# Build for production
pnpm build

# Build for staging
pnpm build:stage

# Preview production build
pnpm preview

# Preview staging build
pnpm preview:stage
```

### Code Quality
```bash
# Run ESLint
pnpm lint

# Fix ESLint issues
pnpm lint:fix

# Type check
pnpm types:check

# Check dependencies for updates
pnpm check:deps:update
```

### Deployment
```bash
# Deploy to staging
pnpm deploy:stage

# Deploy to production
pnpm deploy:prod
```

### Other
```bash
# Generate PWA assets
pnpm generate-pwa-assets

# Generate changelog
pnpm changelog

# Git operations
pnpm git:push
```

## Environment Configuration

Environment files are located in `env/` directory:
- `.env` - Base configuration
- `.env.development` - Development settings
- `.env.production` - Production settings
- `.env.staging` - Staging settings

For local development, copy these to `env-local/` (gitignored) and customize.

### Key Environment Variables

**Development:**
- `VITE_PORT` - Dev server port (default: 3100)
- `VITE_HOST` - Dev server host
- `VITE_PROXY` - Proxy configuration for API and socket

**Production/Staging:**
- `VITE_BUILD_OUT_DIR` - Build output directory
- `VITE_BUILD_OBFUSCATOR` - Enable code obfuscation
- `VITE_BUILD_DROP_CONSOLE` - Remove console statements
- `VITE_BUILD_COMPRESSION` - Enable gzip compression
- `VITE_BUILD_CDN` - Use CDN for dependencies
- `VITE_BUILD_SENTRY_*` - Sentry error tracking configuration

## Code Style Guidelines

### ESLint Configuration
- Uses `@antfu/eslint-config` with custom rules
- UnoCSS support enabled
- `ts/no-namespace` is allowed
- `no-console` is allowed (managed by build process)

### TypeScript
- Strict mode enabled
- Path aliases: `@/*` maps to `src/*`, `~/*` maps to `types/*`
- JSX preserved for Vue
- Module resolution: bundler

### Component Naming
- Components use PascalCase
- Component folders use PascalCase matching the component name
- Each component typically has: `index.ts` (export), `index.vue` (component)

### Auto-Imports
The project uses `unplugin-auto-import` for:
- Vue (ref, reactive, computed, etc.)
- Vue Router (useRoute, useRouter)
- Vue I18n (useI18n)
- Pinia (defineStore, storeToRefs)
- VueUse functions
- Custom hooks from `src/hooks/**`

**Important**: Do not abuse auto-imports. Explicit imports are preferred in large projects for clarity.

### CSS/Styling
- Uses UnoCSS for utility classes
- Custom SCSS in `src/assets/styles/`
- Naive UI CSS variables for theming
- Dark mode support via CSS classes

## Commit Convention

Uses conventional commits with these types:
- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation
- `style`: Code style (formatting, no logic change)
- `refactor`: Code refactoring
- `perf`: Performance improvements
- `test`: Tests
- `chore`: Build process or auxiliary tool changes
- `revert`: Revert previous commit
- `wip`: Work in progress
- `build`: Build system changes
- `types`: Type definitions

### Pre-commit Hooks
- `lint-staged` runs ESLint fix on all staged files
- `commitlint` validates commit messages

## API Layer

The API layer uses a class-based approach:

```typescript
// BaseAPI provides standard CRUD operations
class BaseAPI<T> {
  list(data?)    // POST /{model}/{section}/list
  create(data)   // POST /{model}/{section}
  read(id)       // GET /{model}/{section}/{id}
  update(data)   // PUT /{model}/{section}/{data._id}
  delete(id)     // DELETE /{model}/{section}/{id}
}
```

Axios instance (`AppAxios`) includes:
- Request/response interceptors
- Token refresh logic
- Request deduplication
- Cache adapter
- Retry adapter
- Throttling
- Crypto encryption for sensitive data

## Router Architecture

- Uses `createWebHistory`
- Route guards handle: authentication, encryption, loading bar, lock screen
- Routes are dynamically generated from menu configuration
- Supports route-level caching with keep-alive
- Query/params encryption support for sensitive data

## State Management (Pinia)

Stores are organized by domain:
- `app-*`: App-level state (theme, locale, menu, tab, lock)
- `user-*`: User state (auth, profile, preference, permission)
- `comp-*`: Component state
- `setting-*`: Settings state

All stores use the `useXxxStore` naming convention.

## Security Features

- **OPAQUE protocol**: For password authentication
- **RSA-OAEP**: For asymmetric encryption
- **AES-GCM**: For symmetric encryption
- **HKDF-SHA256**: For key derivation
- **HMAC-SHA256**: For message authentication
- **CAPTCHA (cap)**: Custom CAPTCHA implementation
- **WebAuthn**: FIDO2 support for MFA
- **TOTP**: Time-based one-time passwords
- **Sentry**: Error tracking and monitoring

## Browser Support

- Modern browsers (ESNext target)
- Legacy browser support via `@vitejs/plugin-legacy` (currently disabled)
- Chrome DevTools integration in development

## Important Notes for Agents

1. **Always check existing patterns**: The project has established patterns for components, API calls, and state management. Follow existing conventions.

2. **Type safety**: TypeScript strict mode is enabled. Avoid `any` types and ensure proper type definitions.

3. **Component structure**: When creating new components, follow the folder structure: `ComponentName/index.ts` + `ComponentName/index.vue`.

4. **API functions**: End all API function names with `API` suffix for clear identification.

5. **Storage migrations**: When modifying persistent storage structures, update `src/utils/persistent/migrate.ts`.

6. **Icons**: Uses Iconify with custom build process. SVG icons are in `.svg/` directory.

7. **Testing**: Currently no test suite is configured. Manual testing via demo pages.

8. **Comments**: The codebase uses `// LINK` comments for references and `// TODO`/`// FIXME` for pending work.

9. **Language**: The project uses both English and Chinese. Primary documentation language is English, but code comments may be in Chinese.

10. **Dependencies**: Use pnpm only. The project has `only-allow pnpm` preinstall hook.

## Resources

- [Vue 3 Docs](https://vuejs.org/)
- [Naive UI Docs](https://www.naiveui.com/)
- [Vite Docs](https://vitejs.dev/)
- [UnoCSS Docs](https://unocss.dev/)
- [VueUse Docs](https://vueuse.org/)
